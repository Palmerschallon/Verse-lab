<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
<title>Verse Lab — Demos</title>
<link rel="stylesheet" href="./style.css">
<style>
  /* Page-scoped bits (rest comes from style.css) */
  .stage { position: fixed; inset: 0; background: var(--bg,#000); }
  iframe.demo { position: absolute; inset: 0; width: 100%; height: 100%; border: 0; background:#000 }
  .infobar{
    position:fixed; left:12px; right:12px; bottom:12px; z-index:10;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    border:1px solid var(--line); border-radius:12px;
    background:var(--panel); backdrop-filter:blur(8px) saturate(1.05);
    padding:10px 12px;
  }
  .title{font-weight:700; letter-spacing:.2px}
  .sub{color:var(--muted); font-size:13px; margin-top:2px}
  .dots{display:flex; gap:8px; align-items:center}
  .dot{width:8px; height:8px; border-radius:50%; border:1px solid var(--line); background:transparent; opacity:.7; cursor:pointer}
  .dot.active{background:#fff; opacity:1}
</style>
</head>
<body>

<!-- Full-bleed demo surface -->
<div class="stage" id="stage">
  <iframe id="demoFrame" class="demo" src="" allow="autoplay; fullscreen" title="demo"></iframe>
</div>

<!-- Bottom info bar (name • description • dots) -->
<div class="infobar pad-safe">
  <div class="meta">
    <div class="title" id="demoTitle">—</div>
    <div class="sub" id="demoDesc">—</div>
  </div>
  <div class="dots" id="dots" aria-label="slides"></div>
</div>

<script>
/* ------------------------------------------------------------
   Register demos here (paths are relative to /public)
------------------------------------------------------------- */
const DEMOS = [
  { name: "smoke",          href: "demos/smoke.html",          desc: "RAF sanity check (dot + trails)" },
  { name: "swarm",          href: "demos/swarm.html",          desc: "600–800 agents, obvious motion" },
  { name: "verse-seed-min", href: "demos/verse_seed_min.html", desc: "paste → lexicon → change" },
];

/* Elements */
const frame   = document.getElementById('demoFrame');
const titleEl = document.getElementById('demoTitle');
const descEl  = document.getElementById('demoDesc');
const dotsEl  = document.getElementById('dots');
const stage   = document.getElementById('stage');

/* State */
let idx = 0;

/* Utilities */
function clamp(i){ return (i + DEMOS.length) % DEMOS.length; }
function load(i, {pushHash=true} = {}){
  idx = clamp(i);
  const d = DEMOS[idx];
  frame.src = d.href;
  titleEl.textContent = d.name;
  descEl.textContent  = d.desc;
  renderDots();
  if (pushHash) location.hash = '#'+d.name;
}
function renderDots(){
  dotsEl.innerHTML = DEMOS.map((d,i)=>
    `<span class="dot ${i===idx?'active':''}" data-i="${i}" title="${d.name}"></span>`
  ).join('');
}

/* Dots click */
dotsEl.addEventListener('click', e=>{
  const t = e.target.closest('.dot'); if(!t) return;
  load(parseInt(t.dataset.i,10));
});

/* Keyboard */
addEventListener('keydown', e=>{
  if (e.key === 'ArrowRight') load(idx+1);
  else if (e.key === 'ArrowLeft') load(idx-1);
});

/* Touch/pointer swipe with small momentum */
let dragging=false, x0=0, y0=0, t0=0, vx=0;
stage.addEventListener('pointerdown', e=>{
  dragging=true; x0=e.clientX; y0=e.clientY; t0=performance.now(); vx=0;
  stage.setPointerCapture(e.pointerId);
},{passive:true});
stage.addEventListener('pointermove', e=>{
  if(!dragging) return;
  const t=performance.now(), dt=Math.max(1, t - t0);
  vx = (e.clientX - x0) / dt;          // px per ms
},{passive:true});
stage.addEventListener('pointerup', e=>{
  if(!dragging) return; dragging=false;
  const dx=e.clientX - x0, dy=Math.abs(e.clientY - y0);
  const swipe = Math.abs(dx) > 40 && dy < Math.abs(dx)*0.7;
  const momentum = Math.abs(vx) > 0.35; // quick flick
  if (swipe || momentum){
    if (dx < 0) load(idx+1); else load(idx-1);
  }
},{passive:true});

/* Hash routing (optional direct links) */
function findByName(name){
  const i = DEMOS.findIndex(d => d.name.toLowerCase() === name.toLowerCase());
  return i<0 ? 0 : i;
}
addEventListener('hashchange', ()=>{
  const name = location.hash.replace('#','').trim();
  if(name) load(findByName(name), {pushHash:false});
});

/* First load */
(function init(){
  const name = location.hash.replace('#','').trim();
  load(name ? findByName(name) : 0);
})();
</script>
</body>
</html>
