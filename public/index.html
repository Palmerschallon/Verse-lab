<<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
<title>Verse Lab — Demos</title>
<link rel="stylesheet" href="./style.css">
<style>
  /* page-scoped */
  .logo { position: fixed; left: 12px; top: 12px; z-index: 20; display:flex; align-items:center; gap:8px; }
  .logo img { height:24px; width:auto; display:block; filter:brightness(1); }
  .logo .word { font-weight:700; letter-spacing:.3px }
  .stage { position: fixed; inset: 0; background: var(--bg,#000); }
  iframe.demo { position:absolute; inset:0; width:100%; height:100%; border:0; background:#000 }
  .infobar{
    position:fixed; left:12px; right:12px; bottom:12px; z-index:10;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    border:1px solid var(--line); border-radius:12px;
    background:var(--panel); backdrop-filter:blur(8px) saturate(1.05);
    padding:10px 12px;
  }
  .title{font-weight:700; letter-spacing:.2px}
  .sub{color:var(--muted); font-size:13px; margin-top:2px; max-width:60ch; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .dots{display:flex; gap:8px; align-items:center}
  .dot{width:8px; height:8px; border-radius:50%; border:1px solid var(--line); background:transparent; opacity:.7; cursor:pointer}
  .dot.active{background:#fff; opacity:1}
</style>
</head>
<body>

<a class="logo" href="./">
  <img src="./logo.svg" alt="Verse">
  <span class="word">Verse Lab</span>
</a>

<div class="stage" id="stage">
  <iframe id="demoFrame" class="demo" src="" allow="autoplay; fullscreen" title="demo"></iframe>
</div>

<div class="infobar pad-safe" role="navigation" aria-label="Demo navigation">
  <div class="meta">
    <div class="title" id="demoTitle">—</div>
    <div class="sub" id="demoDesc">—</div>
  </div>
  <div class="dots" id="dots"></div>
</div>

<script>
/* ------------------------------------------------------------
   Minimal swipe carousel that loads demos from /demos/manifest.json
   Manifest format: [{ "name": "smoke", "href": "smoke.html", "desc": "..." }, ...]
------------------------------------------------------------- */
const frame   = document.getElementById('demoFrame');
const titleEl = document.getElementById('demoTitle');
const descEl  = document.getElementById('demoDesc');
const dotsEl  = document.getElementById('dots');
const stage   = document.getElementById('stage');

let DEMOS = [];
let idx = 0;

async function loadManifest(){
  try{
    const r = await fetch('./demos/manifest.json', {cache:'no-store'});
    DEMOS = await r.json();
  }catch(e){
    // fallback so page still works
    DEMOS = [{name:'smoke', href:'smoke.html', desc:'RAF sanity check'}];
  }
  // normalize hrefs to /demos/
  DEMOS = DEMOS.map(d => ({...d, href: d.href.startsWith('demos/') ? d.href : 'demos/'+d.href}));
  // boot
  const hashName = location.hash.replace('#','').trim();
  const start = Math.max(0, DEMOS.findIndex(d=>d.name.toLowerCase()===hashName.toLowerCase()));
  idx = (start>=0? start : 0);
  show(idx, {pushHash:false});
}

function show(i, {pushHash=true}={}){
  if (!DEMOS.length) return;
  idx = (i + DEMOS.length) % DEMOS.length;
  const d = DEMOS[idx];
  frame.src = d.href;
  titleEl.textContent = d.name;
  descEl.textContent  = d.desc || '';
  renderDots();
  if (pushHash) location.hash = '#'+d.name;
}
function renderDots(){
  dotsEl.innerHTML = DEMOS.map((d,i)=>`<span class="dot ${i===idx?'active':''}" data-i="${i}" title="${d.name}"></span>`).join('');
}
dotsEl.addEventListener('click', e=>{
  const t = e.target.closest('.dot'); if(!t) return;
  show(parseInt(t.dataset.i,10));
});
addEventListener('keydown', e=>{
  if (e.key === 'ArrowRight') show(idx+1);
  else if (e.key === 'ArrowLeft') show(idx-1);
});
addEventListener('hashchange', ()=>{
  const n = location.hash.replace('#','').trim();
  const i = DEMOS.findIndex(d=>d.name.toLowerCase()===n.toLowerCase());
  if (i>=0) show(i, {pushHash:false});
});

/* touch swipe with flick momentum */
let dragging=false, x0=0, y0=0, t0=0, vx=0;
stage.addEventListener('pointerdown', e=>{
  dragging=true; x0=e.clientX; y0=e.clientY; t0=performance.now(); vx=0;
  stage.setPointerCapture(e.pointerId);
},{passive:true});
stage.addEventListener('pointermove', e=>{
  if(!dragging) return;
  const dt = Math.max(1, performance.now() - t0);
  vx = (e.clientX - x0) / dt; // px/ms
},{passive:true});
stage.addEventListener('pointerup', e=>{
  if(!dragging) return; dragging=false;
  const dx = e.clientX - x0, dy = Math.abs(e.clientY - y0);
  const swipe = Math.abs(dx) > 40 && dy < Math.abs(dx)*0.7;
  const flick = Math.abs(vx) > 0.35;
  if (swipe || flick) { if (dx < 0) show(idx+1); else show(idx-1); }
},{passive:true});

loadManifest();
</script>
</body>
</html>
