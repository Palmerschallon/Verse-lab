<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>hive horde text — verse</title>
<style>
  :root{
    --bg:#000; --fg:#fff; --accent:#3cf; --text-dim:#888;
  }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);
    font:16px ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace;
    overflow:hidden}
  
  /* Hive container - the collective text space */
  .hive{
    position:fixed; inset:20px; 
    border:1px solid #333; border-radius:8px;
    background:rgba(10,15,20,.95); backdrop-filter:blur(4px);
    padding:20px; overflow:hidden;
    display:flex; flex-direction:column;
  }
  
  /* Horde output - where collective typing appears */
  .horde-output{
    flex:1; overflow-y:auto; overflow-x:hidden;
    line-height:1.6; word-wrap:break-word;
    scroll-behavior:smooth;
  }
  
  /* Text spans with agent attribution */
  .text-agent{
    display:inline; position:relative;
    transition:all 0.3s ease;
  }
  .text-agent:hover{
    background:rgba(60,200,255,0.1);
    box-shadow:0 0 10px rgba(60,200,255,0.3);
  }
  .text-agent[data-agent="hive"]{ color:#3cf; }
  .text-agent[data-agent="swarm"]{ color:#f3c; }
  .text-agent[data-agent="chorus"]{ color:#cf3; }
  .text-agent[data-agent="echo"]{ color:#fc3; opacity:0.7; }
  
  /* Keyboard interface */
  .horde-keyboard{
    margin-top:15px; border-top:1px solid #333; padding-top:15px;
    display:flex; flex-direction:column; gap:10px;
  }
  
  .keyboard-row{
    display:flex; gap:4px; justify-content:center;
  }
  
  .key{
    min-width:40px; height:40px; display:flex; align-items:center; justify-content:center;
    background:#222; border:1px solid #444; border-radius:4px;
    color:var(--fg); font-family:inherit; font-size:14px;
    cursor:pointer; user-select:none; transition:all 0.15s ease;
  }
  .key:hover{ background:#333; border-color:#666; }
  .key:active{ background:#444; transform:translateY(1px); }
  .key.space{ min-width:200px; }
  .key.enter{ min-width:80px; background:#2a4; }
  .key.backspace{ min-width:60px; background:#a42; }
  
  /* Agent indicators */
  .agent-status{
    position:fixed; top:20px; right:20px; 
    display:flex; flex-direction:column; gap:8px;
    font-size:12px; text-align:right;
  }
  .agent-indicator{
    padding:4px 8px; border-radius:12px; 
    background:rgba(0,0,0,0.6); border:1px solid #333;
    transition:all 0.3s ease;
  }
  .agent-indicator.active{ 
    box-shadow:0 0 8px currentColor; 
    border-color:currentColor;
  }
  
  /* Controls */
  .controls{
    position:fixed; top:20px; left:20px;
    display:flex; gap:10px; align-items:center;
    font-size:12px;
  }
  .control-btn{
    padding:6px 12px; border:1px solid #444; border-radius:4px;
    background:#222; color:var(--fg); cursor:pointer;
    transition:all 0.15s ease;
  }
  .control-btn:hover{ background:#333; }
  
  .hint{
    position:fixed; left:50%; bottom:30px; 
    transform:translateX(-50%);
    color:var(--text-dim); font-size:12px; text-align:center;
    opacity:0.8; pointer-events:none;
  }
</style>
</head>
<body>

<div class="hive">
  <div class="horde-output" id="output"></div>
  
  <div class="horde-keyboard">
    <!-- Main letter rows -->
    <div class="keyboard-row">
      <div class="key" data-key="q">q</div>
      <div class="key" data-key="w">w</div>
      <div class="key" data-key="e">e</div>
      <div class="key" data-key="r">r</div>
      <div class="key" data-key="t">t</div>
      <div class="key" data-key="y">y</div>
      <div class="key" data-key="u">u</div>
      <div class="key" data-key="i">i</div>
      <div class="key" data-key="o">o</div>
      <div class="key" data-key="p">p</div>
    </div>
    <div class="keyboard-row">
      <div class="key" data-key="a">a</div>
      <div class="key" data-key="s">s</div>
      <div class="key" data-key="d">d</div>
      <div class="key" data-key="f">f</div>
      <div class="key" data-key="g">g</div>
      <div class="key" data-key="h">h</div>
      <div class="key" data-key="j">j</div>
      <div class="key" data-key="k">k</div>
      <div class="key" data-key="l">l</div>
    </div>
    <div class="keyboard-row">
      <div class="key" data-key="z">z</div>
      <div class="key" data-key="x">x</div>
      <div class="key" data-key="c">c</div>
      <div class="key" data-key="v">v</div>
      <div class="key" data-key="b">b</div>
      <div class="key" data-key="n">n</div>
      <div class="key" data-key="m">m</div>
    </div>
    <!-- Control row -->
    <div class="keyboard-row">
      <div class="key space" data-key=" ">space</div>
      <div class="key enter" data-key="Enter">↵</div>
      <div class="key backspace" data-key="Backspace">⌫</div>
    </div>
  </div>
</div>

<div class="agent-status">
  <div class="agent-indicator" data-agent="hive" style="color:#3cf">HIVE</div>
  <div class="agent-indicator" data-agent="swarm" style="color:#f3c">SWARM</div>
  <div class="agent-indicator" data-agent="chorus" style="color:#cf3">CHORUS</div>
  <div class="agent-indicator" data-agent="echo" style="color:#fc3">ECHO</div>
</div>

<div class="controls">
  <div class="control-btn" id="clearBtn">Clear</div>
  <div class="control-btn" id="toggleAgents">Auto Agents</div>
  <span style="margin-left:8px; color:var(--text-dim)">Agents: <span id="agentCount">0</span></span>
</div>

<div class="hint">
  Click keys or type naturally • Agents respond to patterns • Hold space for multi-word flow
</div>

<script>
/* ========================= HIVE HORDE TEXT SYSTEM ========================= */

// Core state - exposed for agent extension
window.HiveHorde = {
  agents: new Map(),
  output: document.getElementById('output'),
  currentAgent: 'hive',
  autoAgents: true,
  wordBuffer: '',
  lastKeyTime: 0,
  
  // Agent behavior hooks - extend these for custom behaviors
  agentHooks: {
    onInput: new Map(),
    onWordComplete: new Map(),
    onPatternMatch: new Map(),
    onAgentSwitch: new Map()
  },
  
  // Pattern recognition - agents can register new patterns
  patterns: new Map([
    ['question', /\?$/],
    ['exclamation', /!$/],
    ['code', /[{}();]/],
    ['numbers', /\d+/],
    ['repetition', /(.)\1{2,}/],
    ['caps', /[A-Z]{3,}/]
  ])
};

// Agent definitions - modular and extensible
const AgentBehaviors = {
  hive: {
    color: '#3cf',
    trigger: () => true, // always available
    respond: (input, context) => {
      return Math.random() > 0.7 ? ' collective_' + input.slice(-3) : '';
    }
  },
  
  swarm: {
    color: '#f3c',
    trigger: (input) => /\b(many|group|together|cluster)\b/i.test(input),
    respond: (input, context) => {
      const swarmWords = ['buzz', 'gather', 'multiply', 'surge', 'flow'];
      return Math.random() > 0.6 ? ' ' + swarmWords[Math.floor(Math.random() * swarmWords.length)] : '';
    }
  },
  
  chorus: {
    color: '#cf3',
    trigger: (input) => HiveHorde.patterns.get('repetition').test(input),
    respond: (input, context) => {
      const match = input.match(/(.)\1{2,}/);
      return match ? ' echo_' + match[1].repeat(2) : '';
    }
  },
  
  echo: {
    color: '#fc3',
    trigger: (input) => input.length > 0 && Math.random() > 0.85,
    respond: (input, context) => {
      const words = input.split(' ').filter(w => w.length > 3);
      const echo = words[words.length - 1];
      return echo ? ' ~' + echo.slice(-2) : '';
    }
  }
};

// Initialize agents
function initializeAgents() {
  for (const [name, behavior] of Object.entries(AgentBehaviors)) {
    HiveHorde.agents.set(name, {
      ...behavior,
      active: false,
      lastActive: 0
    });
  }
}

// Text output with agent attribution
function appendText(text, agent = 'hive') {
  const span = document.createElement('span');
  span.className = 'text-agent';
  span.setAttribute('data-agent', agent);
  span.textContent = text;
  HiveHorde.output.appendChild(span);
  
  // Auto-scroll to bottom
  HiveHorde.output.scrollTop = HiveHorde.output.scrollHeight;
  
  // Update agent indicator
  updateAgentIndicator(agent);
}

// Agent indicator updates
function updateAgentIndicator(agentName) {
  document.querySelectorAll('.agent-indicator').forEach(el => {
    el.classList.remove('active');
  });
  
  const indicator = document.querySelector(`[data-agent="${agentName}"]`);
  if (indicator) {
    indicator.classList.add('active');
    setTimeout(() => indicator.classList.remove('active'), 1000);
  }
}

// Core input handler - extensible hook system
function processInput(char) {
  const now = Date.now();
  const timeSinceLastKey = now - HiveHorde.lastKeyTime;
  HiveHorde.lastKeyTime = now;
  
  // Handle special keys
  if (char === 'Backspace') {
    if (HiveHorde.output.lastChild) {
      const lastSpan = HiveHorde.output.lastChild;
      if (lastSpan.textContent.length > 1) {
        lastSpan.textContent = lastSpan.textContent.slice(0, -1);
      } else {
        HiveHorde.output.removeChild(lastSpan);
      }
    }
    return;
  }
  
  if (char === 'Enter') {
    appendText('\n', HiveHorde.currentAgent);
    HiveHorde.wordBuffer = '';
    return;
  }
  
  // Add character
  appendText(char, HiveHorde.currentAgent);
  HiveHorde.wordBuffer += char;
  
  // Word boundary detection
  if (char === ' ' || timeSinceLastKey > 1000) {
    processWordComplete();
  }
  
  // Trigger agent responses if auto mode is on
  if (HiveHorde.autoAgents) {
    triggerAgentResponses();
  }
  
  // Call registered hooks
  HiveHorde.agentHooks.onInput.forEach(hook => hook(char));
}

// Word completion handler
function processWordComplete() {
  const word = HiveHorde.wordBuffer.trim();
  if (word.length === 0) return;
  
  // Pattern matching
  for (const [patternName, regex] of HiveHorde.patterns) {
    if (regex.test(word)) {
      HiveHorde.agentHooks.onPatternMatch.forEach(hook => hook(patternName, word));
    }
  }
  
  HiveHorde.agentHooks.onWordComplete.forEach(hook => hook(word));
  HiveHorde.wordBuffer = '';
}

// Agent response system
function triggerAgentResponses() {
  const fullText = HiveHorde.output.textContent;
  const recentText = fullText.slice(-100); // Last 100 chars for context
  
  for (const [name, agent] of HiveHorde.agents) {
    if (name === HiveHorde.currentAgent) continue;
    
    if (agent.trigger(recentText) && Math.random() > 0.8) {
      const response = agent.respond(recentText, { fullText });
      if (response) {
        setTimeout(() => {
          appendText(response, name);
        }, Math.random() * 500 + 200);
      }
    }
  }
}

// Keyboard event handlers
function setupKeyboard() {
  // Virtual keyboard clicks
  document.querySelectorAll('.key').forEach(key => {
    key.addEventListener('click', () => {
      const char = key.getAttribute('data-key');
      processInput(char);
    });
  });
  
  // Physical keyboard
  document.addEventListener('keydown', (e) => {
    e.preventDefault();
    
    if (e.key.length === 1) {
      processInput(e.key);
    } else if (e.key === 'Backspace' || e.key === 'Enter') {
      processInput(e.key);
    }
  });
}

// Control handlers
function setupControls() {
  document.getElementById('clearBtn').addEventListener('click', () => {
    HiveHorde.output.innerHTML = '';
    HiveHorde.wordBuffer = '';
  });
  
  document.getElementById('toggleAgents').addEventListener('click', (e) => {
    HiveHorde.autoAgents = !HiveHorde.autoAgents;
    e.target.textContent = HiveHorde.autoAgents ? 'Auto Agents' : 'Manual Mode';
    e.target.style.background = HiveHorde.autoAgents ? '#2a4' : '#a42';
  });
}

// Agent count display
function updateAgentCount() {
  const activeAgents = Array.from(HiveHorde.agents.values()).filter(a => a.active).length;
  document.getElementById('agentCount').textContent = activeAgents;
}

// Extension API for agents to register themselves
window.HiveHorde.registerAgent = function(name, behavior) {
  HiveHorde.agents.set(name, {
    ...behavior,
    active: false,
    lastActive: 0
  });
};

window.HiveHorde.registerHook = function(hookType, callback) {
  if (HiveHorde.agentHooks[hookType]) {
    HiveHorde.agentHooks[hookType].set(callback.name || 'anonymous', callback);
  }
};

window.HiveHorde.registerPattern = function(name, regex) {
  HiveHorde.patterns.set(name, regex);
};

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  initializeAgents();
  setupKeyboard();
  setupControls();
  
  // Welcome message
  setTimeout(() => {
    appendText('Welcome to the Hive. Begin typing...', 'hive');
    appendText('\n', 'hive');
  }, 500);
  
  setInterval(updateAgentCount, 1000);
});

</script>
</body>
</html>